name: E2E Tests ðŸš€

on:
  # Manual operation when needed during development
  workflow_dispatch:
    inputs:
      test_groups:
        description: 'Test groups to run array'
        required: false
        default: 'all'
  
  # run after every release
  push:
    tags:
      - 'v*.*.*'

jobs:
  e2e-tests:
    name: Run E2E Tests
    runs-on: ubuntu-latest
    timeout-minutes: 25
    strategy:
      fail-fast: false
      matrix:
        test_group: [
          'CreateCommand E2E Tests',
          'InitCommand E2E Tests',
          'ScreenCommand E2E Tests',
          'BindingCommand E2E Tests',
          'ServiceCommand E2E Tests',
          'ViewCommand E2E Tests',
          'ModelCommand E2E Tests',
          'MiddlewareCommand E2E Tests',
          'LocaleCommand E2E Tests',
          'LocaleGenerateCommand E2E Tests',
        ]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: stable
          cache: true

      - name: Cache pub packages
        uses: actions/cache@v4
        with:
          path: ~/.pub-cache
          key: ${{ runner.os }}-pub-${{ hashFiles('pubspec.lock') }}
          restore-keys: |
            ${{ runner.os }}-pub-

      - name: Install dependencies
        run: dart pub get

      - name: Run E2E test - ${{ matrix.test_group }}
        run: dart test --tags e2e --plain-name "${{ matrix.test_group }}" --reporter expanded --concurrency=1
        timeout-minutes: 20