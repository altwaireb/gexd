name: ğŸ“š Documentation Sync

on:
  push:
    branches: 
      - main
    paths:
      - 'doc/**'
      - '.gitbook.yaml'
      - 'README.md'
  workflow_dispatch:

jobs:
  validate-docs:
    name: âœ… Validate Documentation
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
          
      - name: ğŸ” Check Documentation Changes
        id: docs-changes
        uses: dorny/paths-filter@v2
        with:
          filters: |
            docs:
              - 'doc/**'
              - '.gitbook.yaml'
              - 'README.md'
              
      - name: ğŸ“ Validate Documentation Structure
        if: steps.docs-changes.outputs.docs == 'true' || github.event_name == 'workflow_dispatch'
        run: |
          echo "ğŸ” Validating documentation structure..."
          
          # Check if required files exist
          if [ ! -f "doc/1.x/SUMMARY.md" ]; then
            echo "âŒ SUMMARY.md not found in doc/1.x/"
            exit 1
          fi
          
          if [ ! -f "doc/1.x/README.md" ]; then
            echo "âŒ README.md not found in doc/1.x/"
            exit 1
          fi
          
          if [ ! -f ".gitbook.yaml" ]; then
            echo "âŒ .gitbook.yaml not found in root"
            exit 1
          fi
          
          echo "âœ… Documentation structure is valid"
          
      - name: ğŸ“Š Create Documentation Report
        if: steps.docs-changes.outputs.docs == 'true' || github.event_name == 'workflow_dispatch'
        run: |
          echo "## ğŸ“š Documentation Sync Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **Status:** Documentation validated successfully" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ”— **Live Documentation:** https://gexd.gitbook.io/gexd-docs" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ“ **Files checked:**" >> $GITHUB_STEP_SUMMARY
          echo "- \`doc/1.x/README.md\` âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- \`doc/1.x/SUMMARY.md\` âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- \`.gitbook.yaml\` âœ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ”„ **GitBook Integration:** Active and monitoring changes" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "â±ï¸ **Sync Time:** GitBook will update within 1-2 minutes" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "> ğŸ“ Automated documentation validation completed"

      - name: ğŸ“‹ List Documentation Files
        if: steps.docs-changes.outputs.docs == 'true' || github.event_name == 'workflow_dispatch'
        run: |
          echo "ğŸ“‚ Documentation files in this repository:"
          find doc/1.x -name "*.md" | head -20
          echo ""
          echo "ğŸ”¢ Total markdown files: $(find doc/1.x -name "*.md" | wc -l)"